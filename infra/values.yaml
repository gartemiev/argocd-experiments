#applications:
# - name: guestbook
#   namespace: argo-cd
#   finalizers:
#   - resources-finalizer.argocd.argoproj.io
#   project: default
#   source:
#     repoURL: https://github.com/argoproj/argocd-example-apps.git
#     targetRevision: HEAD
#     path: helm-guestbook
#     helm:
#       releaseName: guestbook
#       valueFiles:
#         - values.yaml
#   destination:
#     server: https://kubernetes.default.svc
#     namespace: guestbook
#   syncPolicy:
#     automated:
#       prune: true
#       selfHeal: true
#     syncOptions:
#       - CreateNamespace=true

applicationsets:
# - name: guestbook
#   namespace: argo-cd
#   goTemplate: false
#   generators:
#   - git:
#       repoURL: https://github.com/argoproj/argocd-example-apps.git
#       revision: HEAD
#       directories:
#       - path: guestbook
#       - path: kustomize-*
#   template:
#     metadata:
#       name: '{{path.basename}}'
#     spec:
#       project: default
#       source:
#         repoURL: https://github.com/argoproj/argocd-example-apps.git
#         targetRevision: HEAD
#         path: '{{path}}'
#       destination:
#         server: https://kubernetes.default.svc
#         namespace: '{{path.basename}}'
#       syncPolicy:
#         automated:
#           prune: true
#           selfHeal: true
 - name: public-infra-helmcharts
   namespace: argo-cd
   goTemplate: false
   generators:
     - list:
         elements:
          - publicrepoURL: https://argoproj.github.io/argo-helm
            publicRevision: 0.9.1
            appName: argocd-image-updater
            namespace: argo-cd
   template:
     metadata:
       name: '{{ appName }}'
     spec:
       project: default
       sources:
         - repoURL: '{{ publicrepoURL }}'
           targetRevision: '{{ publicRevision }}'
           chart: argocd-image-updater
           helm:
             valueFiles:
               - $values/infra/{{ appName }}/values.yaml
         - repoURL: https://github.com/gartemiev/argocd-experiments.git
           targetRevision: HEAD
           ref: values
       destination:
         server: https://kubernetes.default.svc
         namespace: '{{ namespace }}'
       syncPolicy:
         automated:
           prune: true
           selfHeal: true
   syncPolicy:
     syncOptions:
       - CreateNamespace=true
     # Set Application finalizer
     preserveResourcesOnDeletion: false